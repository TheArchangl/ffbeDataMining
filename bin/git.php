<?php
    /**
     * User: aEnigma
     * Date: 04.02.2017
     * Time: 17:11
     */

    require_once dirname(__DIR__) . "/bootstrap.php";
    chdir(__DIR__ . "/dat_dec/gl") or die("chdir");

    /*
    $entries = `C:/cmder/vendor/git-for-windows/bin/git.exe ls-files`;
    $entries = explode("\n", $entries);
    $entries = array_filter($entries);

    $versions = [];
    foreach ($entries as $file) {
        $message = `C:/cmder/vendor/git-for-windows/bin/git.exe log -n 1 --pretty=format:%B {$file}`;

        $versions[substr($file, 0, -4)] = explode(" v", trim($message))[1] ?? 0;
    }
    */

    $files = [
        'F_ABILITY_EXPLAIN_MST'                 => '70',
        'F_ABILITY_MST'                         => '78',
        'F_AI_MST'                              => '60',
        'F_ARCHIVE_MST'                         => '17',
        'F_AREA_MST'                            => '83',
        'F_AWARD_EXPLAIN_MST'                   => 0,
        'F_AWARD_MST'                           => 0,
        'F_AWARD_TYPE_MST'                      => 0,
        'F_BANNER_MST'                          => 0,
        'F_BATTLE_BG_MST'                       => '32',
        'F_BATTLE_SCRIPT_MST'                   => '31',
        'F_BEAST_BOARD_PIECE_EXT_MST'           => 0,
        'F_BEAST_BOARD_PIECE_MST'               => '27',
        'F_BEAST_CP_MST'                        => '18',
        'F_BEAST_EXPLAIN_MST'                   => 0,
        'F_BEAST_EXP_PATTERN_MST'               => '18',
        'F_BEAST_GROW_MST'                      => '18',
        'F_BEAST_MST'                           => '21',
        'F_BEAST_SKILL_MST'                     => '25',
        'F_BEAST_STATUS_MST'                    => '19',
        'F_CAPTURE_MST'                         => '5',
        'F_CHALLENGE_MST'                       => '38',
        'F_CHARACTER_MST'                       => '18',
        'F_CLSM_GRADE_MST'                      => 0,
        'F_CLSM_PROGRESS_MST'                   => 0,
        'F_CLSM_RANK_MST'                       => 0,
        'F_CLSM_ROUND_MST'                      => 0,
        'F_CRAFT_EXT_MST'                       => 0,
        'F_DEFINE_MST'                          => '40',
        'F_DIAMOND_MST'                         => '39',
        'F_DUNGEON_MST'                         => '76',
        'F_EFFECT_GROUP_MST'                    => '53',
        'F_EFFECT_MST'                          => '47',
        'F_ENCOUNT_FIELD_MST'                   => '22',
        'F_EQUIP_ITEM_EXPLAIN_MST'              => '56',
        'F_EQUIP_ITEM_MST'                      => '64',
        'F_EXCHANGE_SHOP_ITEM_MST'              => 0,
        'F_EXCHANGE_SHOP_MST'                   => 0,
        'F_EXPEDITION_DIFFICULTY_MST'           => 0,
        'F_EXPEDITION_MST'                      => 0,
        'F_EXVIUS_POINT_REWARD_MST'             => 0,
        'F_FIELD_TREASURE_MST'                  => '42',
        'F_FOOTPRINT_MST'                       => 0,
        'F_FUNCTION_MST'                        => '20',
        'F_GACHA_EFFECT_BLOCK_MST'              => 0,
        'F_GACHA_EFFECT_PATTERN_MST'            => '37',
        'F_GAME_TITLE_MST'                      => '22',
        'F_GIFT_MST'                            => '20',
        'F_ICON_MST'                            => '57',
        'F_IMAGE_SWITCHING_MST'                 => 0,
        'F_IMPORTANT_ITEM_EXPLAIN_MST'          => '26',
        'F_IMPORTANT_ITEM_MST'                  => '24',
        'F_ITEM_EXPLAIN_MST'                    => '49',
        'F_ITEM_EXT_BEAST_MST'                  => '22',
        'F_ITEM_MST'                            => '64',
        'F_JOB_MST'                             => '33',
        'F_LAND_MST'                            => '27',
        'F_LEARNING_MST'                        => 0,
        'F_LIMITBURST_LV_MST'                   => '41',
        'F_LIMITBURST_MST'                      => '49',
        'F_LOGIN_BONUS_MST'                     => '2',
        'F_LOGIN_BONUS_TOTAL_REWARD_MST'        => 0,
        'F_MAGIC_EXPLAIN_MST'                   => '31',
        'F_MAGIC_MST'                           => '34',
        'F_MAP_EVENT_MST'                       => '31',
        'F_MAP_EXT_RESOURCE_MST'                => '29',
        'F_MAP_OBJECT_MST'                      => '17',
        'F_MAP_ROUTE_MST'                       => '20',
        'F_MATERIA_EXPLAIN_MST'                 => '50',
        'F_MATERIA_LIMIT_MST'                   => '33',
        'F_MATERIA_MST'                         => '47',
        'F_MEDAL_EXCHANGE_MST'                  => '41',
        'F_MISSION_MST'                         => '102',
        'F_MONSTER_DICTIONARY_EXPLAIN_MST'      => '41',
        'F_MONSTER_DICTIONARY_MST'              => '40',
        'F_MONSTER_SKILL_MST'                   => '76',
        'F_MONSTER_SKILL_SET_MST'               => '50',
        'F_NPC_MST'                             => '25',
        'F_PICTURE_STORY_MST'                   => '39',
        'F_PLAYBACK_CHAPTER_MST'                => 0,
        'F_PLAYBACK_EVENT_MST'                  => 0,
        'F_PLAYBACK_MAP_MST'                    => 0,
        'F_PLAYBACK_SEASON_MST'                 => 0,
        'F_PURCHASE_AGE_LIMIT_MST'              => 0,
        'F_QUEST_MST'                           => '25',
        'F_QUEST_SUB_MST'                       => '25',
        'F_RB_ABILITY_GROUP_MST'                => '36',
        'F_RB_AI_PATTERN_MST'                   => 0,
        'F_RB_BONUS_RULE_MST'                   => 0,
        'F_RB_DEFINE_MST'                       => 0,
        'F_RB_FORBIDDEN_INFO_MST'               => 0,
        'F_RB_LS_MST'                           => '10',
        'F_RB_LS_REWARD_MST'                    => '5',
        'F_RB_SS_MST'                           => '63',
        'F_RB_SS_REWARD_MST'                    => '14',
        'F_RB_TRADE_BOARD_MST'                  => 0,
        'F_RB_TRADE_BOARD_PIECE_MST'            => 0,
        'F_RECIPE_BOOK_MST'                     => '47',
        'F_RECIPE_MST'                          => '48',
        'F_RESOURCE_MAP_MST'                    => '86',
        'F_RESOURCE_MAP_VERSION_MST_LOCALIZE'   => '144',
        'F_RESOURCE_MST'                        => '89',
        'F_RESOURCE_VERSION_MST_LOCALIZE'       => '183',
        'F_RULE_MST'                            => 0,
        'F_SCENARIO_BATTLE_GROUP_MST'           => '39',
        'F_SCENARIO_BATTLE_MST'                 => '30',
        'F_SEASON_EVENT_ABILITY_MST'            => '25',
        'F_SEASON_EVENT_ABILITY_TYPE_MST'       => '25',
        'F_SEASON_EVENT_GROUP_FRIEND_LV_MST'    => 0,
        'F_SG_TIME_DUNGEON_MST'                 => '3',
        'F_SHOP_MST'                            => '19',
        'F_SOUND_MST'                           => 0,
        'F_SP_CHALLENGE_MST'                    => 0,
        'F_STORE_ITEM_MST'                      => '42',
        'F_STORY_EVENT_MST'                     => '30',
        'F_STORY_MST'                           => '19',
        'F_STORY_SUB_MST'                       => '21',
        'F_STRONGBOX_MST'                       => '20',
        'F_SUBLIMATION_RECIPE_MST'              => '14',
        'F_SWITCH_MST'                          => '62',
        'F_SWITCH_TYPE_MST'                     => '18',
        'F_TEAM_LV_MST'                         => '23',
        'F_TELEPO_MST'                          => '21',
        'F_TEXT_ABILITY_EXPLAIN_LONG'           => '140',
        'F_TEXT_ABILITY_EXPLAIN_SHORT'          => '144',
        'F_TEXT_ABILITY_NAME'                   => '119',
        'F_TEXT_ABILITY_PARAM_MSG'              => 0,
        'F_TEXT_ANALYTICS_ITEMS'                => 0,
        'F_TEXT_ANALYTICS_LOCALIZE'             => 0,
        'F_TEXT_ARCHIVE_NAME'                   => 0,
        'F_TEXT_AREA_NAME'                      => '94',
        'F_TEXT_AWARD_EXPLAIN'                  => 0,
        'F_TEXT_AWARD_NAME'                     => 0,
        'F_TEXT_AWARD_TYPE'                     => 0,
        'F_TEXT_BATTLE_SCRIPT'                  => '64',
        'F_TEXT_BEAST_NAME'                     => '63',
        'F_TEXT_BEAST_SKILL_DES'                => 0,
        'F_TEXT_BEAST_SKILL_NAME'               => '61',
        'F_TEXT_CAPTURE_INFO'                   => 0,
        'F_TEXT_CHALLENGE_NAME'                 => '68',
        'F_TEXT_CHARACTER_NAME'                 => '38',
        'F_TEXT_COLOSSEUM_GRADE'                => 0,
        'F_TEXT_COLOSSEUM_MONSTER_GROUP_NAME'   => 0,
        'F_TEXT_DAILY_QUEST_COMPLETE'           => '18',
        'F_TEXT_DAILY_QUEST_DES'                => 0,
        'F_TEXT_DAILY_QUEST_DETAIL'             => '48',
        'F_TEXT_DAILY_QUEST_NAME'               => 0,
        'F_TEXT_DIAMOND_NAME'                   => '57',
        'F_TEXT_DUNGEON_NAME'                   => '95',
        'F_TEXT_EXCHANGE_SHOP_ITEM'             => 0,
        'F_TEXT_EXPN_STORY'                     => '5',
        'F_TEXT_GACHA'                          => '146',
        'F_TEXT_GAME_TITLE_NAME'                => '16',
        'F_TEXT_IMPORTANT_ITEM_EXPLAIN_LONG'    => '57',
        'F_TEXT_IMPORTANT_ITEM_EXPLAIN_SHORT'   => '55',
        'F_TEXT_IMPORTANT_ITEM_NAME'            => '59',
        'F_TEXT_IMPORTANT_ITEM_SHOP'            => '21',
        'F_TEXT_ITEM_EQUIP_LONG'                => '123',
        'F_TEXT_ITEM_EQUIP_NAME'                => '114',
        'F_TEXT_ITEM_EQUIP_SHORT'               => '114',
        'F_TEXT_ITEM_EXPLAIN_LONG'              => '108',
        'F_TEXT_ITEM_EXPLAIN_SHORT'             => '93',
        'F_TEXT_ITEM_NAME'                      => '93',
        'F_TEXT_JOB_NAME'                       => '98',
        'F_TEXT_LAND_NAME'                      => 0,
        'F_TEXT_LIMIT_BURST_DES'                => '96',
        'F_TEXT_LIMIT_BURST_NAME'               => '86',
        'F_TEXT_MAGIC_EXPLAIN_LONG'             => '88',
        'F_TEXT_MAGIC_EXPLAIN_SHORT'            => '90',
        'F_TEXT_MAGIC_NAME'                     => '72',
        'F_TEXT_MAP_OBJECT'                     => '37',
        'F_TEXT_MATERIA_EXPLAIN_LONG'           => '110',
        'F_TEXT_MATERIA_EXPLAIN_SHORT'          => '111',
        'F_TEXT_MATERIA_NAME'                   => '92',
        'F_TEXT_MISSION'                        => '113',
        'F_TEXT_MONSTER_DICTIONARY_NAME'        => '101',
        'F_TEXT_MONSTER_DIC_EXPLAIN_LONG'       => '103',
        'F_TEXT_MONSTER_DIC_EXPLAIN_SHORT'      => '90',
        'F_TEXT_MONSTER_NAME'                   => '110',
        'F_TEXT_MONSTER_PART_DIC_NAME'          => '78',
        'F_TEXT_MONSTER_SKILL_NAME'             => '104',
        'F_TEXT_MONSTER_SKILL_SET_NAME'         => 0,
        'F_TEXT_NPC_NAME'                       => '84',
        'F_TEXT_PICTURE_STORY_NAME'             => 0,
        'F_TEXT_PLAYBACK'                       => '5',
        'F_TEXT_QUEST'                          => '68',
        'F_TEXT_QUEST_SUB_DETAIL'               => '83',
        'F_TEXT_QUEST_SUB_NAME'                 => '70',
        'F_TEXT_QUEST_SUB_STORY'                => '83',
        'F_TEXT_QUEST_SUB_TARGET_PARAM'         => '47',
        'F_TEXT_RB_ABILITY_GROUP_DESCRIPTION'   => 0,
        'F_TEXT_RB_ABILITY_GROUP_NAME'          => 0,
        'F_TEXT_RB_BONUS_RULE_DESCRIPTION'      => 0,
        'F_TEXT_RB_BONUS_RULE_NAME'             => 0,
        'F_TEXT_RB_FORBIDDEN_INFO_DESCRIPTION'  => 0,
        'F_TEXT_RB_FORBIDDEN_INFO_NAME'         => 0,
        'F_TEXT_RB_LS_NAME'                     => 0,
        'F_TEXT_RB_LS_REWARD_DES'               => 0,
        'F_TEXT_RB_LS_REWARD_TITLE'             => 0,
        'F_TEXT_RB_SS_BONUS_INFO_NAME'          => 0,
        'F_TEXT_RB_SS_FORBIDDEN_INFO_NAME'      => 0,
        'F_TEXT_RB_SS_NAME'                     => 0,
        'F_TEXT_RB_SS_REWARD_DES'               => 0,
        'F_TEXT_RB_SS_REWARD_TITLE'             => 0,
        'F_TEXT_RECIPE_BOOK_NAME'               => '86',
        'F_TEXT_SCENARIO_BATTLE'                => 0,
        'F_TEXT_SEASON_EVENT_ABILITY_NAME'      => 0,
        'F_TEXT_SEASON_EVENT_ABILITY_TYPE_NAME' => 0,
        'F_TEXT_SEASON_EVENT_DESCRIPTION'       => 0,
        'F_TEXT_SEASON_EVENT_NAME'              => 0,
        'F_TEXT_SHOP'                           => '43',
        'F_TEXT_SPCHALLENGE'                    => '5',
        'F_TEXT_STORY_NAME'                     => 0,
        'F_TEXT_STORY_SUB'                      => '71',
        'F_TEXT_SUBLIMATION_EXPLAIN'            => '41',
        'F_TEXT_TELEPO_NAME'                    => '70',
        'F_TEXT_TEXT_EN'                        => '201',
        'F_TEXT_TICKER'                         => 0,
        'F_TEXT_TOWN_EXPLAIN'                   => '66',
        'F_TEXT_TOWN_NAME'                      => '63',
        'F_TEXT_TOWN_STORE'                     => '71',
        'F_TEXT_TOWN_STORE_COMMENT'             => '87',
        'F_TEXT_TOWN_STORE_OWNER_NAME'          => '36',
        'F_TEXT_TRIBE'                          => 0,
        'F_TEXT_TROPHY_EXPLAIN'                 => 0,
        'F_TEXT_TROPHY_METER_SERIF'             => 0,
        'F_TEXT_UNITS_NAME'                     => '93',
        'F_TEXT_UNIT_AFFINITY'                  => '98',
        'F_TEXT_UNIT_DESCRIPTION'               => '111',
        'F_TEXT_UNIT_EVO'                       => '106',
        'F_TEXT_UNIT_EXPLAIN_SHOP'              => '22',
        'F_TEXT_UNIT_FUSION'                    => '103',
        'F_TEXT_UNIT_SUMMON'                    => '101',
        'F_TEXT_WORLD_NAME'                     => 0,
        'F_TICKER_DEFINE_MESSAGE_MST'           => 0,
        'F_TICKER_LOG_CATEGORY_MST'             => 0,
        'F_TICKER_MST'                          => '27',
        'F_TICKET_MST'                          => '2',
        'F_TOWN_EXPLAIN_MST'                    => '21',
        'F_TOWN_MST'                            => '26',
        'F_TOWN_STORE_COMMENT_MST'              => '28',
        'F_TOWN_STORE_MST'                      => '30',
        'F_TRIBE_MST'                           => 0,
        'F_TROPHY_EXPLAIN_MST'                  => '15',
        'F_TROPHY_METER_SERIF_MST'              => 0,
        'F_TROPHY_MST'                          => 0,
        'F_TROPHY_REWARD_MST'                   => '16',
        'F_UNIT_CLASS_UP_MST'                   => '62',
        'F_UNIT_EXPLAIN_MST'                    => '46',
        'F_UNIT_EXP_PATTERN_MST'                => 0,
        'F_UNIT_GROW_MST'                       => '19',
        'F_UNIT_MST'                            => '71',
        'F_UNIT_SERIES_LV_ACQUIRE_MST'          => '56',
        'F_UNKNOWN_1'                           => 0,
        'F_UNKNOWN_2'                           => 0,
        'F_URL_MST'                             => '54',
        'F_WORLD_MST'                           => '19',
    ];

    foreach ($files as $file => $version) {
        if ($version > 0)
            continue;

        $entry    = \Sol\FFBE\GameFile::getEntry($file);
        $versions = \Sol\FFBE\GameFile::getFileVersions($entry);
        rsort($versions);

        $current = file_get_contents(__DIR__ . "/dat_dec/gl/{$file}.txt");

        foreach ($versions as $v) {
            $decoded = file_get_contents(__DIR__ . "/dat_enc/gl/{$file}_v{$v}.txt");
            $decoded = \Sol\FFBE\AES::decode($decoded, $entry->getKey());

            if ($decoded == $current) {
                $version = $v;
                break;
            }
        }

        $files[$file] = $version;
    }

    var_export($files);